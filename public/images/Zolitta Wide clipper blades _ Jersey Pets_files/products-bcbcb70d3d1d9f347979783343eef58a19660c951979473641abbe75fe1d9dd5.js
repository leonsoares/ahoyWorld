(function(){window.redirectToCart=function(t){window.location.href=t};var g=window.Nemo=window.Nemo||{};g.Product={};var d=$("#product-price"),s=$("#product-form"),m=s.find(".product-option-select"),t=s.find(".list-option-select"),l=s.find('input[name="variant_id"]'),w=s.find("#quantity-warning"),i=s.find(".required-legend"),a=s.find('input[type="submit"]');var b=function(){var t=[],i,a,e;for(var n in window.variantMap){i=window.variantMap[n];a="";for(j=0;j<m.length;j++){a+=i.value_ids[j]+"-"}if(a!==""&&a!=="--"){e=a.substring(0,a.length-1);if(t.indexOf(e)===-1){t.push(e)}}}return t}();if(s.find(".required").length>0)i.show();g.Product.updatePrice=function(){var t=l.data("key")||"",i=window.variantMap[t],a,e,n,r;if(!i)return;a=i.price*100;e=i.price_sale*100;n=s.find("[data-price-increase]:checked");for(r=0;r<n.length;r++){var o=$(n[r]).attr("data-price-increase")*100;a+=o;e+=o}a=a/100;e=e/100;d.find("#regular-price").html(g.formatMoney(a));if(i.on_sale){d.find("#sale-price").html(g.formatMoney(e));d.attr("data-on-sale","true")}else{d.find("#sale-price").html("");d.attr("data-on-sale","false")}};g.Product.updateOptions=function(t){t=t||m.first();var i=m.index(t),a=t.val(),e=m.length,n,r,o,d,s,l,f,c,u,p,h,v;var w="";for(n=0;n<i;n++){if(n!==i){o=$(m[n]);w+=o.val()+"-"}}w=w.trim();if(a){o=$(m[i]);d=o.find("option");for(n=0;n<d.length;n++){s=$(d[n]);l=s.val();f=w+l;c=f.split("-");h=false;for(r=0;r<b.length;r++){h=g.Product.checkIfOptionIsAllowed(c,b[r]);if(h)break}if(h){s.removeAttr("disabled");s.removeClass("hidden")}else{s.attr("disabled",true);s.addClass("hidden")}}v=o.find("option:selected");if(v.attr("disabled")){o.val(o.find("option:not(:disabled)").first().val())}}g.Product.updateVariant();g.Product.updatePrice()};g.Product.checkIfOptionIsAllowed=function(t,i){allowedOptionAsArray=i.split("-").slice(0,t.length);return t.toString()===allowedOptionAsArray.toString()};g.Product.refreshWarning=function(){var t=l.data("key")||"",i=window.variantMap[t];if(i){w.find("[data-id]").hide();w.find('[data-id="'+i.id+'"]').show();if(i.out_of_stock){a.attr("disabled","disabled")}else{a.removeAttr("disabled")}}};g.Product.updateVariant=function(){var t,i,a=[],e;if($.isEmptyObject(window.variantMap))return;for(t=0;t<m.length;t++){a.push($(m[t]).val())}i=a.join("-");e=window.variantMap[i];if(e){l.val(e.id);l.data("key",i)}else{l.val("");l.data("key","")}g.Product.refreshWarning()};g.Product.formSubmit=function(s,t,e){var l=$(s).find(".btn"),i=l.attr("data-adding"),a=$(s).find('[name="quantity"]'),n=a.closest("div.form-group"),r=a.val(),o=$(s).find(".use_personalization"),d=[],f=$(s).find(".option-error"),c,u,p;w.find(".alert").hide();if(r<=0){n.addClass("has-error");return false}n.removeClass("has-error");u={variant_id:$(s).find('[name="variant_id"]').val(),quantity:r,success:function(t){var i,a;window.redirectToCart("/cart");i=t.refresh&&t.refresh["cart_icon"];if(i){a=$(i);$("#"+a.attr("id")).replaceWith(a)}if(e.additionalSuccessCallback){e.additionalSuccessCallback(t)}},always:function(t){var i=t["inventory_warning"],a=[],e;if(t["errors"]){a=t["errors"]["personalizations"]||[];e=t["errors"]["variant"]}if(i){$("#quantity-warning").html(i);g.Product.refreshWarning()}if(e){var n=$(s).find("select.product-option-select"),r;for(p=0;p<n.length;p++){if(!$(n[p]).val()){r=$(n[p]).next(".option-error");r.html(e);r.show()}}}for(p=0;p<a.length;p++){var o=a[p],d=$(s).find('[data-name="'+o.name+'"].option-error');if(d){d.html(o.error);d.show()}}l.val(c).removeAttr("disabled")},refresh:["cart_icon"]};for(p=0;p<o.length;p++){var h=$(o[p]);if(h.is('input[type="checkbox"]')){if(h.is(":checked")){d.push({name:h.attr("data-name"),value:h.closest(".form-group").find(".personalization_text").val()})}}else if(h.is("select")){var v=h.val();if(v){d.push({name:h.attr("data-name"),value:"",option_value_id:v})}}}if(d.length>0){u["options"]={personalizations_attributes:d}}c=l.val();if(i){l.val(i)}l.attr("disabled","disabled");for(p=0;p<f.length;p++){$(f[p]).hide()}g.addToCart(u);t.stopPropagation()};m.on("change",function(){m.each(function(){g.Product.updateOptions($(this))})});t.on("change",function(){g.Product.updatePrice()});$(document).on("change",'input[type="checkbox"].use_personalization',function(){var t=$(this).closest(".form-group").find(".personalization-text-wrapper");if($(this).is(":checked")){t.show();g.countdown(t.find(".personalization_text"),"data-maxlength")}else{t.hide()}g.Product.updatePrice()});$(".personalization_text").each(function(){var t=$(this);if(t.is(":visible")){g.countdown(t,"data-maxlength")}});m.each(function(){g.Product.updateOptions($(this))});g.Product.refreshWarning()})();
